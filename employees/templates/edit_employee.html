{% extends "base.html" %}
{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-green-50 shadow-md rounded-lg p-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
  </h2>

  <!-- ‚úÖ –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π -->
  {% if messages %}
    <div class="space-y-2 mb-4">
      {% for message in messages %}
        <div class="px-4 py-2 rounded-md text-sm font-medium
                    {% if message.tags == 'success' %}
                      bg-green-100 text-green-800
                    {% elif message.tags == 'error' %}
                      bg-red-100 text-red-800
                    {% else %}
                      bg-gray-100 text-gray-800
                    {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <form method="post" class="space-y-4">
    {% csrf_token %}

    <!-- –§–∞–º–∏–ª–∏—è -->
    <div>
      <label for="id_last_name" class="block text-sm font-medium text-gray-700 mb-1">
        –§–∞–º–∏–ª–∏—è
      </label>
      <input type="text" name="last_name" id="id_last_name"
             value="{{ employee.last_name }}"
             class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500"
             required>
    </div>

    <!-- –ò–º—è -->
    <div>
      <label for="id_first_name" class="block text-sm font-medium text-gray-700 mb-1">
        –ò–º—è
      </label>
      <input type="text" name="first_name" id="id_first_name"
             value="{{ employee.first_name }}"
             class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500"
             required>
    </div>

    <!-- –û—Ç—á–µ—Å—Ç–≤–æ -->
    <div>
      <label for="id_patronymic" class="block text-sm font-medium text-gray-700 mb-1">
        –û—Ç—á–µ—Å—Ç–≤–æ
      </label>
      <input type="text" name="patronymic" id="id_patronymic"
             value="{{ employee.patronymic }}"
             class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500">
    </div>

    <!-- –†–µ–≥–∏–æ–Ω -->
    <div>
      <label for="id_region_name" class="block text-sm font-medium text-gray-700 mb-1">
        –†–µ–≥–∏–æ–Ω
      </label>
      <select name="region_name" id="id_region_name"
              class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500">
        {% for region in form.region_name.field.queryset %}
          <option value="{{ region.id }}"
                  {% if employee.region_name.id == region.id %}selected{% endif %}>
            {{ region.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- –î–∞—Ç–∞ —Å–ª—É–∂–µ–±–Ω–æ–π –∑–∞–ø–∏—Å–∫–∏ -->
    <div>
      <label for="id_note_date" class="block text-sm font-medium text-gray-700 mb-1">
        –î–∞—Ç–∞ —Å–ª—É–∂–µ–±–Ω–æ–π –∑–∞–ø–∏—Å–∫–∏
      </label>
      <input type="date" name="note_date" id="id_note_date"
             value="{{ employee.note_date|date:'Y-m-d' }}"
             class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500">
    </div>

    <!-- –ù–æ–º–µ—Ä —Å–ª—É–∂–µ–±–Ω–æ–π –∑–∞–ø–∏—Å–∫–∏ -->
    <div>
      <label for="id_note_number" class="block text-sm font-medium text-gray-700 mb-1">
        –ù–æ–º–µ—Ä —Å–ª—É–∂–µ–±–Ω–æ–π –∑–∞–ø–∏—Å–∫–∏
      </label>
      <input type="text" name="note_number" id="id_note_number"
             value="{{ employee.note_number }}"
             class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500">
    </div>

    <!-- –õ–æ–≥–∏–Ω -->
    <div>
      <label for="id_login" class="block text-sm font-medium text-gray-700 mb-1">
        –õ–æ–≥–∏–Ω
      </label>
      <input type="text" name="login" id="id_login"
             value="{{ employee.login }}"
             class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500"
             required>
    </div>

    <!-- –ü–∞—Ä–æ–ª—å —Å –∫–Ω–æ–ø–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
    <div>
      <label for="id_password" class="block text-sm font-medium text-gray-700 mb-1">
        –ü–∞—Ä–æ–ª—å
      </label>
      <div class="flex space-x-2">
        <input type="text" name="password" id="id_password"
               value="{{ employee.password }}"
               class="flex-1 border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500"
               required>
        <button type="button"
                class="bg-gray-200 text-gray-800 px-3 py-2 rounded-md shadow hover:bg-gray-300 transition"
                onclick="generatePassword()">
          –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
        </button>
      </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å -->
    <div>
      <label for="id_status" class="block text-sm font-medium text-gray-700 mb-1">
        –°—Ç–∞—Ç—É—Å
      </label>
      <select name="status" id="id_status"
              class="w-full border rounded-md px-3 py-2 shadow-sm focus:ring focus:ring-indigo-200 focus:border-indigo-500">
        {% for value, label in form.fields.status.choices %}
          <option value="{{ value }}"
                  {% if employee.status == value %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è) -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">
        –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
      </label>
      <input type="text"
             value="{{ employee.created_at|date:'d.m.Y H:i' }}"
             class="w-full border rounded-md px-3 py-2 bg-gray-100 text-gray-600"
             readonly>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="flex justify-center gap-3 pt-2">
      <button type="submit"
              class="bg-green-600 text-white px-5 py-2 rounded-md shadow hover:bg-green-700 transition">
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
      <a href="{{ request.META.HTTP_REFERER|default:'/' }}"
         class="bg-gray-200 text-gray-800 px-5 py-2 rounded-md shadow hover:bg-gray-300 transition">
        ‚ùå –û—Ç–º–µ–Ω–∞
      </a>
    </div>
  </form>
</div>

<script>
function generatePassword() {
  fetch("{% url 'generate_password' %}")
    .then(response => response.json())
    .then(data => {
      document.getElementById("id_password").value = data.password;
    });
}
</script>
{% endblock %}
